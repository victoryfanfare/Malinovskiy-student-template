# HW04 – eda_cli: мини-EDA для CSV и HTTP-сервис

Небольшое CLI-приложение для базового анализа CSV-файлов с поддержкой HTTP API для удалённого взаимодействия.
Используется в рамках Семинаров 03 и 04 курса «Инженерия ИИ».

---

## Требования

* Python 3.11+
* [uv](https://docs.astral.sh/uv/) установлен в систему

---

## Инициализация проекта

В корне проекта (`HW04`):

```bash
uv sync
```

Эта команда:

* создаст виртуальное окружение `.venv`;
* установит зависимости из `pyproject.toml`;
* установит сам проект `eda-cli` в окружение.

---

## Часть 1: CLI-интерфейс

### Краткий обзор датасета

```bash
uv run eda-cli overview data/example.csv
```

**Параметры:**

* `--sep` — разделитель (по умолчанию `,`);
* `--encoding` — кодировка (по умолчанию `utf-8`).

---

### Полный EDA-отчёт

```bash
uv run eda-cli report data/example.csv --out-dir reports
```

**Дополнительные параметры отчёта:**

* `--top-k-categories 5` — сколько top-значений выводить для категориальных признаков
* `--min-missing-share 0.3` — порог доли пропусков для проблемных колонок
* `--max-categories 5` — максимум категориальных колонок для анализа
* `--include-boxplots` — включить боксплоты для числовых колонок
* `--include-category-charts` — включить графики для категориальных признаков
* `--json-summary` — сохранить JSON-сводку по датасету

**В результате в каталоге `reports/` появятся:**

* `report.md` — основной отчёт в Markdown;
* `summary.csv` — таблица по колонкам;
* `missing.csv` — пропуски по колонкам;
* `correlation.csv` — корреляционная матрица (если есть числовые признаки);
* `top_categories/*.csv` — top-k категорий по строковым признакам;
* `summary.json` — полная JSON-сводка (при использовании `--json-summary`);
* `hist_*.png` — гистограммы числовых колонок;
* `missing_matrix.png` — визуализация пропусков;
* `correlation_heatmap.png` — тепловая карта корреляций;
* `boxplots_numeric.png` — боксплоты (при использовании `--include-boxplots`);
* `top_categories_*.png` — графики категорий (при использовании `--include-category-charts`).

---

### Быстрый просмотр данных

```bash
# Первые N строк
uv run eda-cli head data/example.csv --n 10

# Случайная выборка
uv run eda-cli sample data/example.csv --n 5 --random-state 42
```

---

## Часть 2: HTTP-сервис (HW04)

### Запуск сервера

```bash
uv run uvicorn eda_cli.api:app --reload --port 8000
```

Сервис будет доступен по адресу:
[http://localhost:8000](http://localhost:8000)

---

### Доступные эндпоинты

#### 1. Проверка здоровья

```http
GET /health
```

Возвращает статус сервиса.

---

#### 2. Оценка качества по параметрам

```http
POST /quality
```

```json
{
  "n_rows": 1000,
  "n_cols": 10,
  "max_missing_share": 0.1,
  "numeric_cols": 5,
  "categorical_cols": 3
}
```

Оценка качества на основе агрегированных признаков.

---

#### 3. Оценка качества из CSV

```http
POST /quality-from-csv
```

**Параметры (multipart/form-data):**

* `file` — CSV-файл
* `sep` — разделитель (default: `","`)
* `encoding` — кодировка (default: `"utf-8"`)

Возвращает качество с флагами, включая новые эвристики из HW03.

---

#### 4. Полные флаги качества из CSV (новый в HW04)

```http
POST /quality-flags-from-csv
```

Возвращает детализированные флаги качества с акцентом на новых эвристиках:

* константные колонки;
* высокая кардинальность категорий;
* дубликаты ID;
* избыток нулей.

---

#### 5. Полная JSON-сводка датасета

```http
POST /summary-from-csv
```

Возвращает полную структурированную JSON-сводку.

---

#### 6. Топ категорий

```http
POST /top-categories-from-csv
```

**Параметры:**

* `max_columns` — максимум колонок для анализа (default: `5`)
* `top_k` — сколько значений показывать (default: `5`)

---

#### 7. Просмотр данных через API

```http
# Первые N строк
POST /head-from-csv

# Случайная выборка
POST /sample-from-csv
```

---

#### 8. Метрики сервиса

```http
GET /metrics
```

Статистика работы сервиса: количество запросов, успешность, время ответа.

---

### Документация API

* Swagger UI: [http://localhost:8000/docs](http://localhost:8000/docs)
* ReDoc: [http://localhost:8000/redoc](http://localhost:8000/redoc)

---

## Часть 3: Тестирование

### Тестирование ядра

```bash
uv run pytest -q test_core.py
```

**Тесты покрывают:**

* основные функции анализа (`summarize_dataset`, `missing_table`, `correlation_matrix`);
* новые эвристики качества из HW03 (константные колонки, дубликаты ID, нули, кардинальность);
* функции CLI и API;
* обработку CSV-файлов.

---

### Тестирование HTTP-сервиса

```bash
uv run python client.py
```

Клиент автоматически:

* проверит доступность сервиса;
* создаст тестовые CSV-файлы;
* протестирует все эндпоинты;
* выведет сводку по результатам.
